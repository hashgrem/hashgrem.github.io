---
layout: post
title: "LFI - Local file inclusion"
date: 2023-03-09
description: | 
    Discover concepts of local file inclusion (LFI). Learn the potential consequences of LFI attacks, which can range from information disclosure to remote code execution.
author: Teiiko
categories: [cheatsheet]
tags: ["LFI"]
---

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css">
<link rel="stylesheet" href="/css/lil-bootstrap.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



## Introduction
Local File Inclusion (also known as LFI) is the process of including
files, that are already locally present on the server, through the
exploiting of vulnerable inclusion procedures implemented in the
application. This vulnerability occurs, for example, when a page
receives, as input, the path to the file that has to be included and
this input is not properly sanitized, allowing directory traversal characters (such as dot-dot-slash) to be injected. Although
most examples point to vulnerable PHP scripts, we should keep
in mind that it is also common in other technologies such as JSP,
ASP and others <br>

*(Source: OWASP testing guide)*

## How to test ?

Since LFI occurs when paths passed to "include" statements are
not properly sanitized, in a blackbox testing approach, we should
look for scripts which take filenames as parameters.<br>

Consider the following example:<br>

`http://vulnerable-host/preview.php?file=example.html`

This looks as a perfect place to try for LFI. If an attacker is lucky
enough, and instead of selecting the appropriate page from the array by its name, the script directly includes the input parame-
ter, it is possible to include arbitrary files on the server<br>

`http://vulnerable-host/preview.php?file=../../../../etc/passwd`

If the above mentioned conditions are met, an attacker would
see something like the following:<br>

```
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
alex:x:500:500:alex:/home/alex:/bin/bash
margo:x:501:501::/home/margo:/bin/bash
...
```

*(Source: OWASP testing guide)*

## Bypass file extension via null byte

Most of the time, the GET parameter will only take filename in argument. The file extension will be specified in the PHP code, as following:<br>
```php
<?php 
    $file = include($_GET["filename"].".php"); 
?>
```
So, simple substitution with arbitrary filename would not
work as the postfix '.php' is appended. To bypass it, we can add a null-byte behind our requested file. In this case, exploitation would work as following:<br>

`http://vulnerable-host/article.php?=/etc/passwd%00`

## Bypass filters via URL encoding

URL encoding can be very usefull to bypass some filters and special chars in the URL. This exploitation can simply be resumed
by URL encoding your payload. In my case, i often use this site: [URL Encoder](https://www.urlencoder.org/). 
In this exemple, our exploitation would look like this:<br>

`http://vulnerable-host/article.php?=..%252f..%252f..%252fetc%252fpasswd%00`

Know that double URL encoding also works.
## Path truncation (under PHP 5.3)
## PHP Wrappers
## From LFI to RCE via log poisoning
## Using ChatGPT for LFI
## Conclusion
<br><br>Thanks for reading ! Give me a feedback on Discord - `Teiiko#8831`

<button id="back-to-top-btn" class="btn btn-primary2 btn-lg circle"><i class="fas fa-arrow-up"></i></button>

<style>
#back-to-top-btn {
  position: fixed;
  bottom: 20px;
  right: 40px;
  display:none;
  cursor:pointer;
}

</style>

<script>
    // Afficher/masquer le bouton "scroll to top"
$(window).scroll(function() {
  if ($(this).scrollTop() > 100) {
    $('#back-to-top-btn').fadeIn();
  } else {
    $('#back-to-top-btn').fadeOut();
  }
});

// Faire remonter au header de la page lorsque le bouton est cliqu√©
$('#back-to-top-btn').click(function() {
  $('html, body').animate({scrollTop : 0},800);
  return false;
});

</script>